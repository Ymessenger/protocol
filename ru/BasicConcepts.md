# 1. Основные понятия
## 1.1 CommunicationObject
Базовый объект API, который описывает тип передаваемого объекта. 


``` json
{
    "Type" : тип объекта, Unsigned Int8
}
```
Возможные значения Type:
| Type | Описание                    |
|------|-----------------------------|
| 0    | Запрос                      |
| 1    | Ответ                       |
| 2    | Уведомление                 |
| 3    | Межсерверный запрос         |
| 4    | Межсерверное уведомление    |
| 5    | Межсерверный ответ          |
| 6    | Запрос к балансировщику         |
| 7    | Ответ от балансировщика         |
| 8    | Запрос от хаба к клиенту |
| 9    | Ответ от клиента хабу    |
| 10   | Уведомление от балансировщика   |
## 1.2 Клиентское API
### 1.2.1 Request
Запрос от клиента к хабу, наследуется от CommunicationObject. Используется для отправки запроса на получение каких-либо данных (получение истории переписки) или выполнении задачи с возвратом результата (отправка нового сообщения). Ожидается что хаб ответит на запрос соответствующим [Response](###-122-response). Запрос и ответ должны иметь одинаковый `RequestId`. Идентификаторы генерирует клиент при создании  запроса. Вопрос уникальности `RequestId` решает только клиент. Хаб должен корректно обрабатывать запросы с одинаковыми `RequestId` как в рамках одного подключения, так и при получении одинаковых `RequestId` в запросах разных пользователей. 

Базовая структура Request:
| Название    | Тип значения  | Описание                                         |
|-------------|---------------|--------------------------------------------------|
| RequestType | Unsigned Int8 | Тип запроса. Данное поле необходимо, чтобы хаб идентифицировать запрос. Значение можно узнать в описании конкретных запросов в [клиентском API](ClientAPI.md) |
| RequestId   | Int64         | Идентификатор запроса                            |
| Type        | Unsigned Int8 | Всегда 0. См. п.1.1 |
### 1.2.2 Response
Ответ от хаба клиенту, наследуется от CommunicationObject. Отправляется только в ответ на полученный от клиента [Request](###-121-request) (запрос). Должен содержать заполненный `RequestId` из запроса.

Базовая структура Response:
| Название     | Тип значения  | Описание                                                               |
|--------------|---------------|------------------------------------------------------------------------|
| RequestId    | Int64         | Идентификатор запроса                                                  |
| ResponseType | Unsigned Int8 | Тип ответа. Данное поле необходимо, чтобы клиент мог идентифицировать ответ. Значение можно узнать в описании конкретных ответов в [клиентском API](ClientAPI.md#211-ответы-на-запросы) |
| Type         | Unsigned Int8 | Всегда 1. См. п.1.1 | 
| ErrorCode    | Unsigned Int8 | Код ошибки, 0 - запрос выполнился без ошибок
### 1.2.3 Notice

Уведомление от хаба клиенту, наследуется от CommunicationObject. Используется для отправки данных от хаба клиенту без требования ответной реакции клиента (уведомление о новом входящем сообщении).

Базовая структура Notice:

| Название | Тип значения  | Описание                                                               |
|----------|---------------|------------------------------------------------------------------------|
| Code     | Int32         | Тип уведомления. Данное поле необходимо, чтобы клиент мог идентифицировать уведомление. Значение можно узнать в описании конкретных уведомлений в [клиентском API](ClientAPI.md#212-уведомления-от-хаба)    |
| Type     | Unsigned Int8 | Всегда 2. См. п.1.1 |
### 1.2.4 ClientRequest
Запрос от хаба к клиенту, наследуется от Request. Используется когда необходимо отправить от хаба на клиент команду на выполнение какого-то действия и получить от клиента ответ (например, команда на отправку ключей шифрования на другое устройство). Работает аналогично Request, но в обратном направлении.

Базовая структура ClientRequest:
| Название    | Тип значения  | Описание                                         |
|-------------|---------------|--------------------------------------------------|
| RequestType | Unsigned Int8 | Тип запроса. Данное поле необходимо, чтобы клиент мог идентифицировать запрос.                                      |
| RequestId   | Int64         | Идентификатор запроса                            |
| Type        | Unsigned Int8 | Всегда 8. См. п.1.1 |
### 1.2.5 ClientResponse
Ответ от клиента хабу, наследуется от Response. Передает хабу ответ на полученный ранее ClientRequest.

Базовая структура ClientResponse:
| Название     | Тип значения  | Описание                                                               |
|--------------|---------------|------------------------------------------------------------------------|
| RequestId    | Int64         | Идентификатор запроса                                                  |
| ResponseType | Unsigned Int8 | Тип ответа. Данное поле необходимо, чтобы хаб идентифицировать ответ. |
| Type         | Unsigned Int8 | Всегда 9. См. п.1.1 | 
| ErrorCode    | Unsigned Int8 | Код ошибки, 0 - запрос выполнился без ошибок
## 1.3 Межсерверное API
Все данные между хабами передаются в виде сериализованных объектов, наследников CommunicationObject. Сериализация осуществляется с помощью класса BinaryFormatter.
### 1.3.1 NodeRequest
Межсерверный запрос, наследуется от CommunicationObject. 

Базовая структура NodeRequest:
| Название    | Тип значения  | Описание                                                               |
|-------------|---------------|------------------------------------------------------------------------|
| RequestType | Unsigned Int8 | Тип запроса                                                            |
| Type        | Unsigned Int8 | Всегда 3. См. п.1.1 |
| RequestId   | Int64         | Идентификатор запроса                                                  |
### 1.3.2 NodeResponse
Межсерверный ответ, наследуется от Communication Object.

Базовая структура NodeResponse:
| Название     | Тип значения  | Описание                                                               |
|--------------|---------------|------------------------------------------------------------------------|
| ResponseType | Unsigned Int8 | Тип ответа                                                             |
| Type         | Unsigned Int8 | Всегда 5. См. п.1.1 |
| RequestId    | Int64         | Идентификатор запроса                                                  |
| ErrorCode    | Unsigned Int8 | Номер ошибки. Если запрос выполнился успешно, принимает значение 0     |
### 1.3.3 NodeNotice
Межсерверное уведомление. Используется для отправки данных другим хабам. Не требует ответа. С помощью уведомлений хаба передают друг другу информацию о новых пользователях, чатах, сообщения пользователей, новые блоки blockchain и т.д.

Базовая структура NodeNotice:
| Название   | Тип значения  | Описание                                                               |
|------------|---------------|------------------------------------------------------------------------|
| NoticeCode | Int16         | Тип уведомления                                                        |
| Type       | Unsigned Int8 | Всегда 4. См. п.1.1 |
## 1.4 API балансировщика
Балансировщик - сервер, хранящий информацию о участниках сети(хабах), об их лицензиях, публичные ключи хабов и поддерживает блокчейн. С балансировщиком взаимодействуют как хабы, так и клиенты. При взаимодействии "клиент <---> балансировщик" данные передаются в формате JSON, при взаимодействии "хаб <---> балансировщик" используется бинарная сериализация классов. Балансировщик необходим для установки авторизованного соединения между хабами, для верификации хаба, а также для поиска и выдачи клиентам списка доступных хабов.

### 1.4.1 BalancerRequest
Запрос к балансировщику, наследуется от CommunicationObject.

Базовая структура BalancerRequest:
| Название    | Тип значения  | Описание                                                               |
|-------------|---------------|------------------------------------------------------------------------|
| RequestType | Unsigned Int8 | Тип запроса. |
| Type        | Unsigned Int8 | Всегда 6. См. п.1.1 |
| RequestId   | Int64         | Идентификатор запроса                                                  |
### 1.4.2 BalancerResponse
Ответ от балансировщика, наследуется от CommunicationObject.

Базовая структура BalancerResponse:
| Название     | Тип значения  | Описание                                                               |
|--------------|---------------|------------------------------------------------------------------------|
| ResponseType | Unsigned Int8 | Тип ответа                                                             |
| Type         | Unsigned Int8 | Всегда 7. См. п.1.1 |
| RequestId    | Int64         | Идентификатор запроса                                                  |
### 1.4.3 BalancerNotice
Уведомление от балансировщика, наследуется от CommunicationObject.

Базовая структура BalancerNotice:
| Название   | Тип значения  | Описание                                                                |
|------------|---------------|-------------------------------------------------------------------------|
| NoticeType | Unsigned Int8 | Тип уведомления                                                         |
| Type       | Unsigned Int8 | Всегда 10. См. п.1.1 |